name: Add companion site files

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  add-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Create directories
        run: |
          mkdir -p downloads errata datasets workbooks templates/mvp-30 prompt-cards

      - name: Add downloads/index.html
        run: |
          cat > downloads/index.html <<'EOF'
          <!doctype html>
          <html lang="en">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width,initial-scale=1" />
            <title>Downloads — Excel Copilot Mastery Companion</title>
            <link rel="stylesheet" href="/downloads/styles.css" />
          </head>
          <body>
            <header class="header">
              <div class="wrap">
                <h1>Downloads hub</h1>
                <p class="lead">Download the workbook, example datasets, templates, and prompt cards used in the book.</p>
              </div>
            </header>

            <main class="wrap">
              <section class="list">
                <h2>Workbooks</h2>
                <ul>
                  <li><a href="/workbooks/Excel-Copilot-Demo-Pack.xlsx">Excel-Copilot-Demo-Pack.xlsx</a> — demo pack workbook</li>
                </ul>

                <h2>Datasets (CSV)</h2>
                <ul>
                  <li><a href="/datasets/Finance_Data.csv">Finance_Data.csv</a></li>
                  <li><a href="/datasets/Sales_Pipeline.csv">Sales_Pipeline.csv</a></li>
                  <li><a href="/datasets/Marketing_Campaigns.csv">Marketing_Campaigns.csv</a></li>
                  <li><a href="/datasets/HR_Onboarding.csv">HR_Onboarding.csv</a></li>
                </ul>

                <h2>Templates</h2>
                <ul>
                  <li><a href="/templates/mvp-30/mvp-30.zip">MVP-30 templates (zip placeholder)</a></li>
                </ul>

                <h2>Prompt cards</h2>
                <ul>
                  <li><a href="/prompt-cards/prompt-cards.pdf">Prompt cards (PDF placeholder)</a></li>
                </ul>
              </section>

              <section class="notes">
                <h3>Notes & disclaimers</h3>
                <ul>
                  <li>Not affiliated with or endorsed by Microsoft.</li>
                  <li>Microsoft/Excel/Copilot are trademarks of Microsoft Corporation.</li>
                  <li>Outputs must be verified; no guarantee of accuracy.</li>
                </ul>
              </section>
            </main>

            <footer class="footer">
              <div class="wrap">
                <p>&copy; 2026 VOXFORGE HQ</p>
              </div>
            </footer>
          </body>
          </html>
          EOF

      - name: Add downloads/styles.css
        run: |
          cat > downloads/styles.css <<'EOF'
          /* Simple, lightweight styles for the downloads hub */

          :root{
            --bg:#ffffff;
            --card:#f7fbff;
            --accent:#0ea5e9;
            --text:#042027;
            --muted:#4b5563;
            --max:900px;
          }

          *{box-sizing:border-box}
          body{
            margin:0;
            font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
            color:var(--text);
            background:linear-gradient(180deg,#f6fbff 0%,#ffffff 100%);
            -webkit-font-smoothing:antialiased;
          }

          .wrap{
            max-width:var(--max);
            margin:28px auto;
            padding:18px;
          }

          .header h1{ margin:6px 0 4px; font-size:20px }
          .lead{ color:var(--muted); margin-bottom:16px }

          .list h2{ margin-top:18px }
          .list ul{ list-style:none; padding-left:0 }
          .list li{ background:var(--card); padding:12px; border-radius:8px; margin-bottom:8px; box-shadow: 0 1px 0 rgba(2,6,23,0.04) }
          .list a{ color:var(--accent); text-decoration:none; font-weight:600 }

          .notes{ margin-top:20px; color:var(--muted); font-size:14px }

          .footer{ text-align:center; margin-top:30px; color:var(--muted) }

          /* Mobile */
          @media (max-width:520px){
            .wrap{ padding:12px }
            .list li{ padding:10px }
          }
          EOF

      - name: Add downloads/README.md
        run: |
          cat > downloads/README.md <<'EOF'
          # Downloads hub

          This folder contains the web pages for the downloads hub. Files linked from this page should be placed in the following locations:

          - Workbook: /workbooks/Excel-Copilot-Demo-Pack.xlsx
          - Datasets: /datasets/Finance_Data.csv, /datasets/Sales_Pipeline.csv, /datasets/Marketing_Campaigns.csv, /datasets/HR_Onboarding.csv
          - Templates: /templates/mvp-30/mvp-30.zip
          - Prompt cards: /prompt-cards/prompt-cards.pdf

          Placeholders
          - At first some files may be placeholders (zips or PDFs with "placeholder" text). Replace them with final versions when ready.

          If a download link 404s:
          - Confirm the file exists at the path above.
          - Confirm GitHub Pages is configured and the branch is published.
          - Open an issue if you need help.
          EOF

      - name: Add errata/index.html
        run: |
          cat > errata/index.html <<'EOF'
          <!doctype html>
          <html lang="en">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width,initial-scale=1" />
            <title>Errata & changelog — Excel Copilot Mastery</title>
            <link rel="stylesheet" href="/styles.css" />
          </head>
          <body>
            <header class="site-header">
              <div class="container">
                <h1>Errata & changelog</h1>
                <p class="subtitle">Track changes, updates and known issues for companion downloads.</p>
              </div>
            </header>

            <main class="container main-content">
              <section>
                <p>Find release notes in <a href="/errata/changelog.md">changelog.md</a> and common issues with practical fixes in <a href="/errata/known-issues.md">known-issues.md</a>.</p>
              </section>
            </main>

            <footer class="site-footer">
              <div class="container">
                <p>Not affiliated with or endorsed by Microsoft. Microsoft/Excel/Copilot are trademarks of Microsoft Corporation.</p>
                <p>Outputs must be verified; no guarantee of accuracy.</p>
                <p>&copy; 2026 VOXFORGE HQ</p>
              </div>
            </footer>
          </body>
          </html>
          EOF

      - name: Add errata/changelog.md
        run: |
          cat > errata/changelog.md <<'EOF'
          # Changelog

          All notable changes to companion downloads are documented here.

          ## v1.0 — 2026-03-01
          - Initial release of companion downloads for "Excel Copilot Mastery".
          - Added demo workbook placeholder (Excel-Copilot-Demo-Pack.xlsx).
          - Added datasets:
            - Finance_Data.csv
            - Sales_Pipeline.csv
            - Marketing_Campaigns.csv
            - HR_Onboarding.csv
          - Added templates (MVP-30 placeholder) and prompt cards placeholder PDF.
          - Added downloads hub and errata pages.

          ## v1.1 — TBD
          - Minor corrections to datasets and sample workbook.
          - Fix broken links in downloads hub (if any).
          - Improve README and documentation.

          (Additional versions will be added to this file as the companion materials evolve.)
          EOF

      - name: Add errata/known-issues.md
        run: |
          cat > errata/known-issues.md <<'EOF'
          # Known issues & practical fixes (Common Copilot problems)

          This document lists common issues users encounter when using Copilot with Excel and practical fixes or workarounds.

          1. Feature not visible / Copilot pane isn't available
          - Symptom: The Copilot button or sidebar does not appear in Excel.
          - Fixes:
            - Confirm you have a Copilot-enabled Office subscription and the correct Office channel.
            - Ensure Excel desktop is updated to the latest version.
            - Check IT/tenant settings (admins may need to enable Copilot).
            - Try signing out/in of Office and restarting Excel.

          2. Copilot returns vague or non-actionable responses
          - Symptom: Answers are high-level or not specific to the workbook.
          - Fixes:
            - Provide more context in the prompt: reference sheet names, cell ranges, and examples.
            - Use stepwise prompts (ask for concrete formulas or steps).
            - Show Copilot the relevant table by selecting it first.

          3. Copilot uses the wrong range or table in its answer
          - Symptom: Copilot writes formulas that use an unrelated range.
          - Fixes:
            - Explicitly name the range or convert the data to an Excel Table and reference the table name.
            - In the prompt, include the exact range (e.g., A2:E200) or table name (SalesData).
            - Where possible, create a small reproducible example worksheet.

          4. Generated formula returns #VALUE!, #REF! or incorrect results
          - Symptom: Copilot output causes Excel errors.
          - Fixes:
            - Inspect the suggested formula and validate range sizes and data types.
            - Test with a small subset of rows first.
            - Use Evaluate Formula (Formulas > Evaluate Formula) to step through and identify the failure point.

          5. Copilot suggests deprecated functions or wrong regional separators
          - Symptom: Formula uses functions not available in the user's Excel version or uses commas/semicolons incorrectly.
          - Fixes:
            - Specify Excel version or regional settings in the prompt.
            - Replace deprecated functions with supported equivalents (e.g., SWITCH fallback).
            - Verify list separator in Excel settings and adjust generated formulas accordingly.

          6. Copilot modifies or overwrites existing workbook content unexpectedly
          - Symptom: Suggested actions overwrite formulas or data.
          - Fixes:
            - Work on a copy of the workbook when running exploratory prompts.
            - Use "Undo" immediately if an unwanted change is applied.
            - Request dry-run or pseudo-code instead of direct edits.

          7. Large datasets cause slow responses or timeouts
          - Symptom: Copilot is slow or times out on big sheets.
          - Fixes:
            - Provide a reduced sample slice of the data in the prompt.
            - Summarize dataset characteristics (columns, number of rows) instead of pasting everything.
            - Pre-aggregate or sample data into a smaller table for analysis.

          8. Copilot misinterprets business terms or column names
          - Symptom: Copilot maps columns incorrectly (e.g., treating "CloseDate" as a text field).
          - Fixes:
            - Rename columns to clearer labels or include a short schema in the prompt (column: type).
            - Give examples of expected input and output formats.

          9. Conflicting instructions or multiple-step tasks produce inconsistent outputs
          - Symptom: When asked to perform many transformations, Copilot misses steps or mixes outputs.
          - Fixes:
            - Break complex tasks into smaller, numbered steps.
            - Confirm intermediate outputs before asking for the next transformation.
            - Ask Copilot to return a summary of steps it will take before executing.

          10. Security/privacy concerns with sensitive or proprietary data
          - Symptom: Concern over sending sensitive data to cloud-based Copilot.
          - Fixes:
            - Remove or pseudonymize sensitive data before using Copilot.
            - Use local-only automation or on-prem solutions where available.
            - Consult organizational policy and IT before sharing proprietary datasets.

          If you encounter an issue not listed here:
          - Open an issue in this repository with a reproducible example (redacted if needed).
          - Include Excel version, Copilot availability, and a small sample workbook if possible.
          EOF

      - name: Add SECURITY.md
        run: |
          cat > SECURITY.md <<'EOF'
          # Security policy

          If you discover a security vulnerability in these materials or in an associated downloadable file, please report it responsibly.

          Reporting
          - Preferred: send an email to security@voxforgehq.com with "Security report — excel-copilot-demo-pack" in the subject.
          - If you need to share sensitive files or proof-of-concept exploit code, encrypt them and include the decryption instructions for the recipient.

          What to include
          - A concise description of the issue
          - Where the issue appears (file path, page URL, or dataset name)
          - Steps to reproduce
          - Expected vs actual behavior
          - Any suggested mitigation

          Response
          - We will acknowledge receipt within 3 business days and share our remediation plan.

          Notes
          - Do not post security issues publicly until they are fixed.
          - For general repository issues and feature requests, please open a regular GitHub issue.
          EOF

      - name: Add placeholders (.gitkeep)
        run: |
          printf '%s\n' '# placeholder to ensure the datasets folder exists' > datasets/.gitkeep
          printf '%s\n' '# placeholder to ensure the workbooks folder exists' > workbooks/.gitkeep
          printf '%s\n' '# placeholder to ensure the template folder exists' > templates/mvp-30/.gitkeep
          printf '%s\n' '# placeholder to ensure the prompt-cards folder exists' > prompt-cards/.gitkeep

      - name: Commit & push
        run: |
          git config user.name "voxforgehq-bot"
          git config user.email "hello@voxforgehq.com"
          git add .
          git commit -m "Add GitHub Pages site files, downloads, errata, SECURITY and placeholders (v1.0)" || echo "No changes to commit"
          git pull --rebase origin main
          git push origin HEAD:main
